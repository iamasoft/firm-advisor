# 2ГИС. Тестовое задание для Java-разработчика.

## Введение
Сельский староста Иван Сусанин решил отправиться в тур по сибирским городам и хочет узнать, в каком городе развлечения лучше. Многократно искать одно и то же в каждом населенном пункте ему не хочется (а кому захочется в его возрасте?). Вот бы иметь сервис, который упростит эту непростую задачу! Предлагаем такую возможность реализовать и тем самым помочь нашему герою.

## Постановка задачи
Необходимо реализовать веб­сервис, который принимает на вход сферу деятельности (например, кинотеатр, кафе, боулинг и т.п.) и выполняет поиск наиболее популярной фирмы в каждом из городов: Новосибирске, Омске, Томске, Кемерово и Новокузнецке. Результатом должен быть документ в формате JSON со списком найденных фирм, отсортированных по их рейтингу на Флампе. Для каждой фирмы должны присутствовать следующие данные: название, адрес, рейтинг Флампа.

### Требования к реализации

- язык программирования Java;
- наличие HTTP API, состоящего из одного метода поиска;
- использование API 2ГИС;
- для повышения отзывчивости сервиса рекомендуем выполнять запросы к API 2ГИС параллельно и асинхронно.

## Пример поиска
_Входные данные_: кинотеатр

_Выходные данные_:

| Название | Адрес | Рейтинг Флампа |
| --- | --- | --- |
| Победа, кинотеатр | Новосибирск, Ленина, 7 | 4.7 |
| Москва, кинотеатр | Кемерово, Дзержинского, 2 | 4.5 |
| Киномакс, кинотеатр | Томск, Розы Люксембург, 73 | 4.0 |
| Планета Кино, кинотеатр | Новокузнецк, Тольятти, 27а | 4.0 |
| Слава, кинотеатр | Омск, Фрунзе, 1 к4 | 3.8 |

# Инструкции по сборке и запуску

Для сборки приложения требуется наличие в системе следующих программ:
- Java 8 SDK
- Apache Maven 3.x

Для корректной работы Apache Maven необходимо, чтобы переменная окружения `JAVA_HOME` указывала на установленный Java 8 SDK.

## Конфигурация
Для корректной работы приложению необходимо задать уникальный ключ пользователя API. Это можно сделать двумя способами:
- задать значение параметра `2gis.api.key` в файле `src/main/resources/properties.xml`
- указать параметр `-D2gis.api.key=<api key>` при сборке

Также можно изменить набор городов, в которых будет производиться поиск филиалов путём изменения параметра `search.in.cities` в файле `src/main/resources/properties.xml`.
По умолчанию поиск производится в городах: Новосибирск, Омск, Томск, Кемерово и Новокузнецк.

## Сборка и запуск
### Embedded Jetty
Наиболее простой способ запустить приложение Firm Advisor - использовать плагин Jetty для Maven:

	mvn jetty:run

Или, в случае задания ключа 2GIS API при сборке:

	mvn jetty:run -D2gis.api.key=<api key>

Веб-сервер будет запущен на порту 8080, веб-приложение будет доступно по адресу <http://localhost:8080/firm-advisor>.

### Запуск в контейнере Java EE
Также можно собрать приложение в веб-архив и запустить его в любом контейнере приложений, например Apache Tomcat.
Для сборки архива необходимо выполнить следующую команду:

	mvn clean install -D2gis.api.key=<api key>

После успешной сборки архив веб-приложения `target/firm-advisor.war` может быть загружен в любой контейнер приложений, поддерживающий Java EE.

## Работа с приложением	
Протестировать работу веб-сервиса можно, обратившить в любом доступном HTTP-клиенте по адресу `http://localhost:8080/firm-advisor/api/firms?category=CATEGORY`, где `CATEGORY` - сфера деятельности, фирмы из которой необходимо найти (например, "кинотеатр", "бассеин", "ресторан" и т.п.):
- открыть URL `http://localhost:8080/firm-advisor/api/firms?category=CATEGORY` в веб-браузере, например <http://localhost:8080/firm-advisor/api/firms?category=бассеин>
- при наличии установленной программы `cURL`, из интерфейса командной строки выполнить:

		curl http://localhost:8080/firm-advisor/api/firms?category=CATEGORY
	
*Замечание*: Jetty ожидает, что все HTTP-запросы содержат параметры в кодировке `UTF-8`, поэтому запросы из командной строки Windows (или из Internet Explorer), содержащие нелатинские символы, могут завершиться неудачей. В таком случае следует кодировать параметры запроса методом [percent encoding](https://en.wikipedia.org/wiki/Percent-encoding), либо использовать другой HTTP-клиент, либо запускать команду в PowerShell.

### Пример ответа веб-сервиса
Запрос по адресу: 

	http://localhost:8080/firm-advisor/api/firms?category=бассеин

Ответ:

	[ {
	  "name" : "GREEN WOOD, wellness-центр",
	  "address" : "Новосибирск, Дачное шоссе, 2/4",
	  "flampRating" : 4.5
	}, {
	  "name" : "Спортивно-оздоровительный комплекс",
	  "address" : "Омск, Лицкевича площадь, 1",
	  "flampRating" : 4.5
	}, {
	  "name" : "Родник, оздоровительный комплекс",
	  "address" : "Новокузнецк, Орджоникидзе, 23а",
	  "flampRating" : 4.5
	}, {
	  "name" : "Нептун, оздоровительный центр",
	  "address" : "Томск, Фрунзе проспект, 240а ст10",
	  "flampRating" : 4.0
	}, {
	  "name" : "Лазурный, ООО, губернский универсальный спортивный комплекс",
	  "address" : "Кемерово, Советский проспект, 70",
	  "flampRating" : 4.0
	} ]
